<template>
  <div class="company-detail">
    <!-- Èù¢ÂåÖÂ±ëÂØºËà™ -->
    <div class="breadcrumb-nav">
      <el-breadcrumb separator="/">
        <el-breadcrumb-item @click="$router.push('/interview-questions')">
          <span class="breadcrumb-link">‰ºÅ‰∏öÈ¢òÂ∫ì</span>
        </el-breadcrumb-item>
        <el-breadcrumb-item>{{ company.name }}</el-breadcrumb-item>
      </el-breadcrumb>
    </div>

    <!-- ÂÖ¨Âè∏‰ø°ÊÅØÂ§¥ÈÉ® -->
    <div class="company-header">
      <div class="company-logo">
        <img :src="company.logo || '/default-company-logo.png'" :alt="company.name">
      </div>
      <div class="company-info">
        <h1 class="company-title">
          {{ company.name }} Èù¢ËØïÁúüÈ¢ò
          <span class="plus-badge" v-if="company.isPremium">Plus</span>
        </h1>
        <p class="company-desc">{{ company.description }}</p>
        <div class="company-stats">
          <div class="stat-item">
            <span class="stat-number">{{ company.totalQuestions }}</span>
            <span class="stat-label">ÈÅìÈ¢òÁõÆ</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ company.questionSets.length }}</span>
            <span class="stat-label">Â•óÈ¢òÈõÜ</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getAvgDifficulty() }}</span>
            <span class="stat-label">Âπ≥ÂùáÈöæÂ∫¶</span>
          </div>
        </div>
      </div>
      <div class="company-actions">
        <el-button type="primary" size="large" @click="startCompanyMockInterview">
          ÂºÄÂßãÊ®°ÊãüÈù¢ËØï
        </el-button>
        <el-button size="large" @click="showBatchUploadDialog">
          Ê∑ªÂä†È¢òÈõÜ
        </el-button>
      </div>
    </div>

    <!-- Á≠õÈÄâÂå∫Âüü -->
    <div class="filter-section">
      <div class="filter-left">
        <el-select v-model="filters.direction" placeholder="ÊäÄÊúØÊñπÂêë" clearable style="width: 150px" @change="handleFilterChange">
          <el-option label="ÂÖ®ÈÉ®" value=""></el-option>
          <el-option label="Java" value="java"></el-option>
          <el-option label="ÂâçÁ´Ø" value="frontend"></el-option>
          <el-option label="Â§ßÊï∞ÊçÆ" value="bigdata"></el-option>
          <el-option label="ÁÆóÊ≥ï" value="algorithm"></el-option>
          <el-option label="ËøêÁª¥" value="devops"></el-option>
          <el-option label="ÊµãËØï" value="testing"></el-option>
        </el-select>
        
        <el-select v-model="filters.difficulty" placeholder="ÈöæÂ∫¶" clearable style="width: 120px" @change="handleFilterChange">
          <el-option label="ÂÖ®ÈÉ®" value=""></el-option>
          <el-option label="ÁÆÄÂçï" value="easy"></el-option>
          <el-option label="‰∏≠Á≠â" value="medium"></el-option>
          <el-option label="Âõ∞Èöæ" value="hard"></el-option>
        </el-select>
        
        <el-select v-model="filters.year" placeholder="Âπ¥‰ªΩ" clearable style="width: 120px" @change="handleFilterChange">
          <el-option label="ÂÖ®ÈÉ®" value=""></el-option>
          <el-option 
            v-for="year in yearOptions" 
            :key="year" 
            :label="year" 
            :value="year">
          </el-option>
        </el-select>
      </div>
      
      <div class="filter-right">
        <el-input v-model="filters.keyword" placeholder="ÊêúÁ¥¢È¢òÈõÜÊàñÈ¢òÁõÆ" clearable style="width: 250px" @input="handleFilterChange">
          <template #prefix>
            <el-icon><Search /></el-icon>
          </template>
        </el-input>
      </div>
    </div>

    <!-- È¢òÈõÜÂàóË°® -->
    <div class="question-sets" v-loading="loading">
      <div 
        v-for="questionSet in filteredQuestionSets" 
        :key="questionSet.id"
        class="question-set-card"
      >
        <!-- È¢òÈõÜÂ§¥ÈÉ® -->
        <div class="set-header">
          <div class="set-title-section">
            <h3 class="set-title">{{ questionSet.name }}</h3>
            <div class="set-meta">
              <el-tag :type="getDifficultyType(questionSet.difficulty)" size="small">
                {{ getDifficultyLabel(questionSet.difficulty) }}
              </el-tag>
              <el-tag type="info" size="small">{{ getTechLabel(questionSet.direction) }}</el-tag>
              <span class="set-year">{{ questionSet.year }}Âπ¥</span>
              <span class="question-count">{{ questionSet.questionCount }}ÈÅìÈ¢ò</span>
              <span class="view-count">{{ questionSet.viewCount || 0 }}Ê¨°ÊµèËßà</span>
            </div>
          </div>
          <div class="set-actions">
            <el-button 
              size="small" 
              @click="toggleQuestions(questionSet)"
              :icon="questionSet.expanded ? 'ArrowUp' : 'ArrowDown'"
            >
              {{ questionSet.expanded ? 'Êî∂Ëµ∑' : 'Â±ïÂºÄ' }}
            </el-button>
            <el-button size="small" @click="favoriteSet(questionSet)" :type="questionSet.isFavorite ? 'primary' : 'default'">
              <el-icon><Star /></el-icon>
              {{ questionSet.favoriteCount || 0 }}
            </el-button>
            <el-button type="primary" size="small" @click="startSetPractice(questionSet)">
              ÂºÄÂßãÁªÉ‰π†
            </el-button>
          </div>
        </div>

        <!-- È¢òÁõÆÂàóË°®ÔºàÂèØÊäòÂè†Ôºâ -->
        <div v-if="questionSet.expanded" class="questions-list">
          <div v-if="questionSet.questions.length === 0" class="empty-questions">
            <el-empty description="ÊöÇÊó†È¢òÁõÆÊï∞ÊçÆ" :image-size="80" />
          </div>
          <div v-else>
            <div 
              v-for="(question, index) in questionSet.questions" 
              :key="question.id"
              class="question-item"
            >
              <div class="question-number">{{ index + 1 }}.</div>
              <div class="question-content">
                <p class="question-text">{{ question.content }}</p>
                <div class="question-tags">
                  <el-tag size="small" type="success">{{ question.type }}</el-tag>
                  <el-tag size="small" type="warning" v-if="question.isHot">üî• ÁÉ≠Èó®</el-tag>
                  <el-tag size="small" v-if="question.difficulty">{{ getDifficultyLabel(question.difficulty) }}</el-tag>
                </div>
              </div>
              <div class="question-actions">
                <el-button size="small" @click="viewQuestionDetail(question)">
                  Êü•ÁúãËØ¶ÊÉÖ
                </el-button>
                <el-button size="small" type="primary" @click="practiceQuestion(question)">
                  ÂºÄÂßãÁªÉ‰π†
                </el-button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Á©∫Áä∂ÊÄÅ -->
      <div v-if="filteredQuestionSets.length === 0" class="empty-state">
        <el-empty description="ÊöÇÊó†Á¨¶ÂêàÊù°‰ª∂ÁöÑÈ¢òÈõÜ" :image-size="120">
          <el-button type="primary" @click="showBatchUploadDialog">Ê∑ªÂä†È¢òÈõÜ</el-button>
        </el-empty>
      </div>
    </div>

    <!-- ÊâπÈáèÂΩïÂÖ•È¢òÈõÜÂØπËØùÊ°Ü -->
    <el-dialog v-model="batchUploadDialogVisible" title="Ê∑ªÂä†È¢òÈõÜ" width="800px" :close-on-click-modal="false">
      <el-form :model="batchForm" :rules="batchRules" ref="batchFormRef" label-width="120px">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <div class="form-section">
          <h4>Âü∫Êú¨‰ø°ÊÅØ</h4>
          <el-row :gutter="20">
            <el-col :span="12">
              <el-form-item label="È¢òÈõÜÂêçÁß∞" prop="setName">
                <el-input v-model="batchForm.setName" placeholder="Â¶ÇÔºöJavaÈ´òÁ∫ßÂ∑•Á®ãÂ∏àÈù¢ËØïÈ¢òÔºà2024Êò•ÊãõÔºâ"></el-input>
              </el-form-item>
            </el-col>
            <el-col :span="12">
              <el-form-item label="ÊäÄÊúØÊñπÂêë" prop="direction">
                <el-select v-model="batchForm.direction" placeholder="ÈÄâÊã©ÊäÄÊúØÊñπÂêë" style="width: 100%">
                  <el-option label="Java" value="java"></el-option>
                  <el-option label="ÂâçÁ´Ø" value="frontend"></el-option>
                  <el-option label="Â§ßÊï∞ÊçÆ" value="bigdata"></el-option>
                  <el-option label="ÁÆóÊ≥ï" value="algorithm"></el-option>
                  <el-option label="ËøêÁª¥" value="devops"></el-option>
                  <el-option label="ÊµãËØï" value="testing"></el-option>
                </el-select>
              </el-form-item>
            </el-col>
          </el-row>
          
          <el-row :gutter="20">
            <el-col :span="12">
              <el-form-item label="ÈöæÂ∫¶Á∫ßÂà´" prop="difficulty">
                <el-select v-model="batchForm.difficulty" placeholder="ÈÄâÊã©ÈöæÂ∫¶" style="width: 100%">
                  <el-option label="ÁÆÄÂçï" value="easy"></el-option>
                  <el-option label="‰∏≠Á≠â" value="medium"></el-option>
                  <el-option label="Âõ∞Èöæ" value="hard"></el-option>
                </el-select>
              </el-form-item>
            </el-col>
            <el-col :span="12">
              <el-form-item label="Èù¢ËØïÂπ¥‰ªΩ" prop="year">
                <el-select v-model="batchForm.year" placeholder="ÈÄâÊã©Âπ¥‰ªΩ" style="width: 100%">
                  <el-option 
                    v-for="year in yearOptions" 
                    :key="year" 
                    :label="year" 
                    :value="year">
                  </el-option>
                </el-select>
              </el-form-item>
            </el-col>
          </el-row>
        </div>

        <!-- È¢òÁõÆÂàóË°® -->
        <div class="form-section">
          <div class="section-header">
            <h4>È¢òÁõÆÂàóË°®</h4>
            <div class="section-actions">
              <el-button size="small" @click="addQuestion">+ Ê∑ªÂä†È¢òÁõÆ</el-button>
              <el-button size="small" @click="showBatchInputDialog">ÊâπÈáèËæìÂÖ•</el-button>
            </div>
          </div>
          
          <div class="questions-list-form">
            <div 
              v-for="(question, index) in batchForm.questions" 
              :key="index"
              class="question-item-form"
            >
              <div class="question-number">{{ index + 1 }}.</div>
              <div class="question-input">
                <el-input
                  v-model="question.content"
                  type="textarea"
                  :rows="2"
                  :placeholder="`ËØ∑ËæìÂÖ•Á¨¨${index + 1}È¢òÂÜÖÂÆπ`"
                  maxlength="500"
                  show-word-limit
                ></el-input>
              </div>
              <div class="question-actions">
                <el-button size="small" type="danger" @click="removeQuestion(index)" :disabled="batchForm.questions.length <= 1">
                  Âà†Èô§
                </el-button>
              </div>
            </div>
          </div>
        </div>
      </el-form>
      
      <template #footer>
        <el-button @click="batchUploadDialogVisible = false">ÂèñÊ∂à</el-button>
        <el-button @click="previewQuestionSet">È¢ÑËßàÊïàÊûú</el-button>
        <el-button type="primary" @click="handleBatchSubmit" :loading="batchUploading">‰øùÂ≠òÈ¢òÈõÜ</el-button>
      </template>
    </el-dialog>

    <!-- ÊâπÈáèËæìÂÖ•ÂØπËØùÊ°Ü -->
    <el-dialog v-model="batchInputDialogVisible" title="ÊâπÈáèËæìÂÖ•È¢òÁõÆ" width="600px">
      <div class="batch-input-tip">
        <p>ËØ∑ÊØèË°åËæìÂÖ•‰∏ÄÈÅìÈ¢òÁõÆÔºåÁ≥ªÁªü‰ºöËá™Âä®ÂàÜÂâ≤Ôºö</p>
      </div>
      <el-input
        v-model="batchInputText"
        type="textarea"
        :rows="10"
        placeholder="‰æãÂ¶ÇÔºö
1. Ëß£ÈáäSpring IOCÂÆπÂô®ÁöÑÂ∑•‰ΩúÂéüÁêÜÔºü
2. Â¶Ç‰ΩïÂÆûÁé∞ÂàÜÂ∏ÉÂºèÈîÅÔºü
3. MySQLÁ¥¢Âºï‰ºòÂåñÊúâÂì™‰∫õÁ≠ñÁï•Ôºü"
      ></el-input>
      <template #footer>
        <el-button @click="batchInputDialogVisible = false">ÂèñÊ∂à</el-button>
        <el-button type="primary" @click="handleBatchInput">Á°ÆÂÆöÂØºÂÖ•</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script>
import { ref, reactive, onMounted, computed } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Search, Star, ArrowUp, ArrowDown } from '@element-plus/icons-vue'

export default {
  name: 'CompanyDetail',
  components: {
    Search,
    Star,
    ArrowUp,
    ArrowDown
  },
  setup() {
    const route = useRoute()
    const router = useRouter()
    
    // ÂìçÂ∫îÂºèÊï∞ÊçÆ
    const loading = ref(false)
    const company = ref({})
    
    // Âä®ÊÄÅÁîüÊàêÂπ¥‰ªΩÈÄâÈ°π
    const currentYear = new Date().getFullYear()
    const yearOptions = Array.from({ length: 6 }, (_, i) => String(currentYear - i))
    
    // Á≠õÈÄâÊù°‰ª∂
    const filters = reactive({
      direction: '',
      difficulty: '',
      year: '',
      keyword: ''
    })
    
    // ÊâπÈáèÂΩïÂÖ•Áõ∏ÂÖ≥
    const batchUploadDialogVisible = ref(false)
    const batchUploading = ref(false)
    const batchFormRef = ref()
    const batchForm = reactive({
      setName: '',
      direction: '',
      difficulty: '',
      year: '',
      questions: [
        { content: '' }
      ]
    })
    
    const batchRules = {
      setName: [{ required: true, message: 'ËØ∑ËæìÂÖ•È¢òÈõÜÂêçÁß∞', trigger: 'blur' }],
      direction: [{ required: true, message: 'ËØ∑ÈÄâÊã©ÊäÄÊúØÊñπÂêë', trigger: 'change' }],
      difficulty: [{ required: true, message: 'ËØ∑ÈÄâÊã©ÈöæÂ∫¶Á∫ßÂà´', trigger: 'change' }],
      year: [{ required: true, message: 'ËØ∑ÈÄâÊã©Èù¢ËØïÂπ¥‰ªΩ', trigger: 'change' }]
    }
    
    // ÊâπÈáèËæìÂÖ•Áõ∏ÂÖ≥
    const batchInputDialogVisible = ref(false)
    const batchInputText = ref('')
    
    // ËÆ°ÁÆóËøáÊª§ÂêéÁöÑÈ¢òÈõÜÂàóË°®
    const filteredQuestionSets = computed(() => {
      if (!company.value.questionSets) return []
      
      return company.value.questionSets.filter(set => {
        // ÊäÄÊúØÊñπÂêëÁ≠õÈÄâ
        if (filters.direction && set.direction !== filters.direction) {
          return false
        }
        
        // ÈöæÂ∫¶Á≠õÈÄâ
        if (filters.difficulty && set.difficulty !== filters.difficulty) {
          return false
        }
        
        // Âπ¥‰ªΩÁ≠õÈÄâ
        if (filters.year && set.year !== parseInt(filters.year)) {
          return false
        }
        
        // ÂÖ≥ÈîÆËØçÁ≠õÈÄâ
        if (filters.keyword) {
          const keyword = filters.keyword.toLowerCase()
          const matchTitle = set.name.toLowerCase().includes(keyword)
          const matchQuestions = set.questions.some(q => 
            q.content.toLowerCase().includes(keyword)
          )
          if (!matchTitle && !matchQuestions) {
            return false
          }
        }
        
        return true
      })
    })
    
    // Â∑•ÂÖ∑ÂáΩÊï∞
    const getTechLabel = (tech) => {
      const labels = {
        java: 'Java',
        frontend: 'ÂâçÁ´Ø',
        bigdata: 'Â§ßÊï∞ÊçÆ',
        algorithm: 'ÁÆóÊ≥ï',
        devops: 'ËøêÁª¥',
        testing: 'ÊµãËØï'
      }
      return labels[tech] || tech
    }
    
    const getDifficultyLabel = (difficulty) => {
      const labels = {
        easy: 'ÁÆÄÂçï',
        medium: '‰∏≠Á≠â',
        hard: 'Âõ∞Èöæ'
      }
      return labels[difficulty] || difficulty
    }
    
    const getDifficultyType = (difficulty) => {
      const types = {
        easy: 'success',
        medium: 'warning',
        hard: 'danger'
      }
      return types[difficulty] || ''
    }
    
    const getAvgDifficulty = () => {
      if (!company.value.questionSets || company.value.questionSets.length === 0) {
        return 'ÊöÇÊó†'
      }
      
      const difficulties = company.value.questionSets.map(set => set.difficulty)
      const counts = { easy: 0, medium: 0, hard: 0 }
      difficulties.forEach(d => counts[d]++)
      
      if (counts.hard > counts.medium && counts.hard > counts.easy) return 'Âõ∞Èöæ'
      if (counts.medium > counts.easy) return '‰∏≠Á≠â'
      return 'ÁÆÄÂçï'
    }
    
    // ÂàùÂßãÂåñ‰ºÅ‰∏öÊï∞ÊçÆ
    const initCompanyData = () => {
      // Ê®°ÊãüÊ†πÊçÆË∑ØÁî±ÂèÇÊï∞Ëé∑Âèñ‰ºÅ‰∏öÊï∞ÊçÆ
      const companyId = parseInt(route.params.id)
      
      // Ê®°Êãü‰ºÅ‰∏öÊï∞ÊçÆ
      const mockCompanies = {
        1: {
          id: 1,
          name: 'ÈòøÈáåÂ∑¥Â∑¥',
          logo: '/logos/alibaba.png',
          description: '‰∏≠ÂõΩÈ¢ÜÂÖàÁöÑÁîµÂïÜÂíå‰∫ëËÆ°ÁÆóÂÖ¨Âè∏ÔºåËá¥Âäõ‰∫éËÆ©Â§©‰∏ãÊ≤°ÊúâÈöæÂÅöÁöÑÁîüÊÑè',
          isPremium: true,
          totalQuestions: 156,
          questionSets: [
            {
              id: 1,
              name: 'JavaÈ´òÁ∫ßÂºÄÂèëÂ∑•Á®ãÂ∏àÈù¢ËØïÈ¢òÔºà2024Êò•ÊãõÔºâ',
              direction: 'java',
              difficulty: 'hard',
              year: 2024,
              questionCount: 15,
              viewCount: 1250,
              favoriteCount: 89,
              expanded: false,
              questions: [
                { 
                  id: 1, 
                  content: 'ËØ∑Ëß£ÈáäSpring IOCÂÆπÂô®ÁöÑÂ∑•‰ΩúÂéüÁêÜÔºå‰ª•ÂèäÂ¶Ç‰ΩïÂÆûÁé∞‰æùËµñÊ≥®ÂÖ•Ôºü', 
                  type: 'ÁÆÄÁ≠îÈ¢ò',
                  isHot: true,
                  difficulty: 'medium'
                },
                { 
                  id: 2, 
                  content: 'Â¶Ç‰ΩïÂÆûÁé∞ÂàÜÂ∏ÉÂºèÈîÅÔºüËØ∑ÊØîËæÉRedisÂíåZookeeper‰∏§ÁßçÊñπÊ°àÁöÑ‰ºòÁº∫ÁÇπ„ÄÇ', 
                  type: 'ÁÆÄÁ≠îÈ¢ò',
                  difficulty: 'hard'
                },
                { 
                  id: 3, 
                  content: 'MySQLÁ¥¢Âºï‰ºòÂåñÊúâÂì™‰∫õÁ≠ñÁï•ÔºüËØ∑ÁªìÂêàÂÆûÈôÖÊ°à‰æãËØ¥Êòé„ÄÇ', 
                  type: 'ÁÆÄÁ≠îÈ¢ò',
                  difficulty: 'medium'
                }
              ]
            },
            {
              id: 2,
              name: 'ÂâçÁ´ØÂºÄÂèëÈù¢ËØïÈ¢òÔºà2024Ê†°ÊãõÔºâ',
              direction: 'frontend',
              difficulty: 'medium',
              year: 2024,
              questionCount: 12,
              viewCount: 890,
              favoriteCount: 45,
              expanded: false,
              questions: [
                { 
                  id: 4, 
                  content: 'Vue3 Composition APIÁõ∏ÊØîOptions APIÊúâÂì™‰∫õ‰ºòÂäøÔºü', 
                  type: 'ÁÆÄÁ≠îÈ¢ò',
                  difficulty: 'medium'
                },
                { 
                  id: 5, 
                  content: 'Â¶Ç‰ΩïÂÆûÁé∞ÂâçÁ´ØÊÄßËÉΩ‰ºòÂåñÔºüËØ∑‰ªéÂ§ö‰∏™Áª¥Â∫¶ÂàÜÊûê„ÄÇ', 
                  type: 'ÁÆÄÁ≠îÈ¢ò',
                  isHot: true,
                  difficulty: 'medium'
                }
              ]
            }
          ]
        }
      }
      
      company.value = mockCompanies[companyId] || {}
    }
    
    // ‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞
    const handleFilterChange = () => {
      // Á≠õÈÄâÈÄªËæëÂ∑≤ÈÄöËøáËÆ°ÁÆóÂ±ûÊÄßÂÆûÁé∞
    }
    
    const toggleQuestions = (questionSet) => {
      questionSet.expanded = !questionSet.expanded
    }
    
    const favoriteSet = (questionSet) => {
      questionSet.isFavorite = !questionSet.isFavorite
      if (questionSet.isFavorite) {
        questionSet.favoriteCount = (questionSet.favoriteCount || 0) + 1
        ElMessage.success('Êî∂ËóèÊàêÂäü')
      } else {
        questionSet.favoriteCount = Math.max(0, (questionSet.favoriteCount || 0) - 1)
        ElMessage.success('ÂèñÊ∂àÊî∂Ëóè')
      }
    }
    
    const startSetPractice = (questionSet) => {
      router.push(`/practice/set/${questionSet.id}`)
    }
    
    const startCompanyMockInterview = () => {
      router.push(`/mock-interview?company=${company.value.id}`)
    }
    
    const viewQuestionDetail = (question) => {
      router.push(`/question/${question.id}`)
    }
    
    const practiceQuestion = (question) => {
      router.push(`/practice/question/${question.id}`)
    }
    
    // ÊâπÈáèÂΩïÂÖ•Áõ∏ÂÖ≥ÊñπÊ≥ï
    const showBatchUploadDialog = () => {
      batchUploadDialogVisible.value = true
    }
    
    const addQuestion = () => {
      batchForm.questions.push({ content: '' })
    }
    
    const removeQuestion = (index) => {
      if (batchForm.questions.length > 1) {
        batchForm.questions.splice(index, 1)
      }
    }
    
    const showBatchInputDialog = () => {
      batchInputDialogVisible.value = true
    }
    
    const handleBatchInput = () => {
      if (!batchInputText.value.trim()) {
        ElMessage.warning('ËØ∑ËæìÂÖ•È¢òÁõÆÂÜÖÂÆπ')
        return
      }
      
      // Ëß£ÊûêÊâπÈáèËæìÂÖ•ÁöÑÊñáÊú¨
      const lines = batchInputText.value.split('\n').filter(line => line.trim())
      const questions = lines.map(line => {
        // ÁßªÈô§Â∫èÂè∑ÔºàÂ¶Ç "1. "Ôºâ
        const content = line.replace(/^\d+\.\s*/, '').trim()
        return { content }
      }).filter(q => q.content)
      
      if (questions.length === 0) {
        ElMessage.warning('Êú™Ëß£ÊûêÂà∞ÊúâÊïàÈ¢òÁõÆ')
        return
      }
      
      batchForm.questions = questions
      batchInputDialogVisible.value = false
      batchInputText.value = ''
      
      ElMessage.success(`ÊàêÂäüÂØºÂÖ• ${questions.length} ÈÅìÈ¢òÁõÆ`)
    }
    
    const previewQuestionSet = () => {
      ElMessage.info('È¢ÑËßàÂäüËÉΩÂºÄÂèë‰∏≠...')
    }
    
    const handleBatchSubmit = async () => {
      try {
        await batchFormRef.value.validate()
        
        // È™åËØÅÈ¢òÁõÆÂÜÖÂÆπ
        const validQuestions = batchForm.questions.filter(q => q.content.trim())
        if (validQuestions.length === 0) {
          ElMessage.warning('ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏ÄÈÅìÈ¢òÁõÆ')
          return
        }
        
        batchUploading.value = true
        
        // Ê®°ÊãüAPIË∞ÉÁî®
        const questionSet = {
          id: Date.now(),
          name: batchForm.setName,
          direction: batchForm.direction,
          difficulty: batchForm.difficulty,
          year: parseInt(batchForm.year),
          questionCount: validQuestions.length,
          viewCount: 0,
          favoriteCount: 0,
          expanded: false,
          questions: validQuestions.map((q, index) => ({
            id: Date.now() + index,
            content: q.content,
            type: 'ÁÆÄÁ≠îÈ¢ò',
            difficulty: batchForm.difficulty
          }))
        }
        
        // Êõ¥Êñ∞‰ºÅ‰∏öÊï∞ÊçÆ
        company.value.questionSets.push(questionSet)
        company.value.totalQuestions += validQuestions.length
        
        ElMessage.success('È¢òÈõÜÊ∑ªÂä†ÊàêÂäü')
        batchUploadDialogVisible.value = false
        
        // ÈáçÁΩÆË°®Âçï
        Object.keys(batchForm).forEach(key => {
          if (key === 'questions') {
            batchForm[key] = [{ content: '' }]
          } else {
            batchForm[key] = ''
          }
        })
        
      } catch (error) {
        ElMessage.error('Ê∑ªÂä†Â§±Ë¥•Ôºö' + error.message)
      } finally {
        batchUploading.value = false
      }
    }
    
    // ÁîüÂëΩÂë®Êúü
    onMounted(() => {
      initCompanyData()
    })
    
    return {
      loading,
      company,
      yearOptions,
      filters,
      filteredQuestionSets,
      batchUploadDialogVisible,
      batchUploading,
      batchFormRef,
      batchForm,
      batchRules,
      batchInputDialogVisible,
      batchInputText,
      handleFilterChange,
      toggleQuestions,
      favoriteSet,
      startSetPractice,
      startCompanyMockInterview,
      viewQuestionDetail,
      practiceQuestion,
      showBatchUploadDialog,
      addQuestion,
      removeQuestion,
      showBatchInputDialog,
      handleBatchInput,
      previewQuestionSet,
      handleBatchSubmit,
      getTechLabel,
      getDifficultyLabel,
      getDifficultyType,
      getAvgDifficulty
    }
  }
}
</script>

<style scoped>
.company-detail {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  background: #f8f9fa;
  min-height: 100vh;
}

/* Èù¢ÂåÖÂ±ëÂØºËà™ */
.breadcrumb-nav {
  margin-bottom: 24px;
}

.breadcrumb-link {
  color: #1890ff;
  cursor: pointer;
}

.breadcrumb-link:hover {
  text-decoration: underline;
}

/* ÂÖ¨Âè∏‰ø°ÊÅØÂ§¥ÈÉ® */
.company-header {
  display: flex;
  align-items: flex-start;
  gap: 24px;
  margin-bottom: 32px;
  padding: 32px;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

.company-logo {
  width: 80px;
  height: 80px;
  border-radius: 16px;
  overflow: hidden;
  flex-shrink: 0;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.company-logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.company-info {
  flex: 1;
  min-width: 0;
}

.company-title {
  margin: 0 0 12px 0;
  font-size: 28px;
  font-weight: 700;
  color: #262626;
  display: flex;
  align-items: center;
  gap: 12px;
}

.plus-badge {
  background: #ff9800;
  color: #fff;
  font-size: 14px;
  font-weight: 500;
  padding: 4px 12px;
  border-radius: 8px;
  line-height: 1;
}

.company-desc {
  margin: 0 0 20px 0;
  font-size: 16px;
  color: #666;
  line-height: 1.6;
}

.company-stats {
  display: flex;
  gap: 32px;
}

.stat-item {
  text-align: center;
}

.stat-number {
  display: block;
  font-size: 24px;
  font-weight: 700;
  color: #1890ff;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 14px;
  color: #666;
}

.company-actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  flex-shrink: 0;
}

/* Á≠õÈÄâÂå∫Âüü */
.filter-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.filter-left {
  display: flex;
  gap: 16px;
}

.filter-right {
  flex-shrink: 0;
}

/* È¢òÈõÜÂàóË°® */
.question-sets {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.question-set-card {
  background: #fff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
}

.question-set-card:hover {
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
}

.set-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 24px;
  border-bottom: 1px solid #f0f0f0;
}

.set-title-section {
  flex: 1;
  min-width: 0;
}

.set-title {
  margin: 0 0 12px 0;
  font-size: 20px;
  font-weight: 600;
  color: #262626;
  line-height: 1.4;
}

.set-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.set-year, .question-count, .view-count {
  font-size: 14px;
  color: #666;
}

.set-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
}

/* È¢òÁõÆÂàóË°® */
.questions-list {
  padding: 24px;
  background: #fafafa;
}

.empty-questions {
  text-align: center;
  padding: 40px;
}

.question-item {
  display: flex;
  gap: 16px;
  padding: 16px;
  margin-bottom: 16px;
  background: #fff;
  border-radius: 12px;
  border: 1px solid #e8e8e8;
  transition: all 0.3s ease;
}

.question-item:hover {
  border-color: #1890ff;
  box-shadow: 0 2px 8px rgba(24, 144, 255, 0.1);
}

.question-item:last-child {
  margin-bottom: 0;
}

.question-number {
  font-size: 16px;
  font-weight: 600;
  color: #1890ff;
  flex-shrink: 0;
  width: 32px;
  text-align: center;
}

.question-content {
  flex: 1;
  min-width: 0;
}

.question-text {
  margin: 0 0 12px 0;
  font-size: 16px;
  color: #262626;
  line-height: 1.6;
}

.question-tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.question-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
  align-items: flex-start;
}

/* Á©∫Áä∂ÊÄÅ */
.empty-state {
  text-align: center;
  padding: 60px;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

/* Ë°®ÂçïÊ†∑Âºè */
.form-section {
  margin-bottom: 24px;
}

.form-section h4 {
  margin: 0 0 16px 0;
  font-size: 16px;
  font-weight: 600;
  color: #262626;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.section-actions {
  display: flex;
  gap: 8px;
}

.questions-list-form {
  max-height: 400px;
  overflow-y: auto;
  border: 1px solid #e8e8e8;
  border-radius: 8px;
  padding: 16px;
  background: #fafafa;
}

.question-item-form {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
  align-items: flex-start;
}

.question-item-form:last-child {
  margin-bottom: 0;
}

.question-number {
  font-size: 14px;
  font-weight: 500;
  color: #666;
  margin-top: 8px;
  flex-shrink: 0;
  width: 24px;
}

.question-input {
  flex: 1;
}

.question-actions {
  flex-shrink: 0;
  margin-top: 4px;
}

/* ÊâπÈáèËæìÂÖ•ÊèêÁ§∫ */
.batch-input-tip {
  margin-bottom: 12px;
  padding: 12px;
  background: #f6ffed;
  border: 1px solid #b7eb8f;
  border-radius: 8px;
}

.batch-input-tip p {
  margin: 0;
  font-size: 14px;
  color: #52c41a;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .company-detail {
    padding: 16px;
  }
  
  .company-header {
    flex-direction: column;
    text-align: center;
  }
  
  .company-stats {
    justify-content: center;
  }
  
  .filter-section {
    flex-direction: column;
    align-items: stretch;
  }
  
  .filter-left {
    flex-direction: column;
    gap: 12px;
  }
  
  .set-header {
    flex-direction: column;
    gap: 16px;
  }
  
  .set-actions {
    width: 100%;
    justify-content: center;
  }
  
  .question-item {
    flex-direction: column;
    gap: 12px;
  }
  
  .question-actions {
    justify-content: center;
  }
}

/* ÊªöÂä®Êù°Ê†∑Âºè */
.questions-list-form::-webkit-scrollbar {
  width: 6px;
}

.questions-list-form::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.questions-list-form::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.questions-list-form::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
</style> 